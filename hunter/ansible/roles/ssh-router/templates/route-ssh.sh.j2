#!/bin/bash
# SSH routing script - routes connections to appropriate user containers

# Display hunter banner
cat /opt/magenta/ascii-art/hunter-ascii-dark.txt 2>/dev/null || cat << 'BANNER'
 ##*###+++++=++++*++***#+==-++*###******#####%##%##
 *+*+*++***+***##***.............:*####*#####%###%#
 ***++*++#*#####+...:.::+*#*+-.....=##***##########
 ++**#######%#....:+*###%#%###%####:..-+***###*####
 +***+######....*#%############%####%-.:.######*###
 **##*###% ...=%######################%...-*#######
 #**####  ...=%####**##################% ...*######
 ####*#.....:%%%############%#%#%#######%....+#####
 ##*##......*####%################%%**###=....%####
 ***# ......+###**###########%######****#* ...:####
 **#:......:-##**###*=-+##%##%########**** ....*###
 ##-.........=*###......-..+-+=.....:=*%*+ ....:###
 #%:. ...... ##%. %+##*=-=+###:-*##%##=.#* . .. -**
 ##     ....-#%.++-.. :.=+**##+#.* .-.**:*-  .. ..*
 % ..  . . .*##*+%%%######+###+##*+###+***= ....=:#
 *=  .  .  .*###%##**##%#*+*###+#%+*#*#**+-....:+##
 ::  .  ....:#####%%####**+*###%*#######*+:....####
 *# ... ....=##%#%#####++*=+==*-#+#%##%#**.. ..-###
 ** ..   -.:-**#%#%##**##==.:.:-##*+#####-..... *##
 #*=.... .+= ***##%#+##*   .:.- . ##%=###...... ###
 ###. ....%--#***###% . ..=-.::=....##:+#+.....+*+#
 ##  .....  .***##%.. .+****-===--... +**%  .. ###*
 #..: ...  ..**=##*-*#*++=-:==--++**=.*##. ....-***
 *= .... . **++##*+##=++++=+++=-=*##%#*#% .. ...***
 **#+ +   +*++##*##*=*#+*######++##%***%. .. ..===*
 +***  .:=**+*######*####:##########+=+.... .  +++=
 ===++ .++#**##**##*##+###.=+***###++*#.+:.. ....=*
 =-=+**.*#*#######***####+++..::::=++#%.-= ..::=*=-
 -=*..:****###*###*####=-.*=*:::-=++++*:-++**+-+- .
 ┌───────────────────────────────────────┐
 │                                       │
 │  |                    |               │
 │  __ \   |   |  __ \   __|   _ \   __| │
 │  | | |  |   |  |   |  |     __/  |    │
 │ _| |_| \__,_| _|  _| \__| \___| _|    │
 │                                       │
 └───────────────────────────────────────┘
    the storyteller
BANNER

USER=$1

if [ -z "$USER" ]; then
    echo "Error: No user specified"
    exit 1
fi

CONTAINER="${USER}-arthel"

# Check if container exists and is running
if ! docker ps --format '{% raw %}{{.Names}}{% endraw %}' | grep -q "^${CONTAINER}$"; then
    echo "Error: Container ${CONTAINER} not found or not running"
    exit 1
fi

# If SSH_ORIGINAL_COMMAND is set, execute it in the container
# Otherwise, start an interactive shell
if [ -n "$SSH_ORIGINAL_COMMAND" ]; then
    docker exec -it "$CONTAINER" su - magent -c "$SSH_ORIGINAL_COMMAND"
else
    docker exec -it "$CONTAINER" su - magent
fi
